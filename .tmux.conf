bind n
unbind p
unbind 1
unbind 2
unbind 3
unbind 4
unbind 5
unbind 6
unbind 7
unbind 8
unbind 9
unbind 0

bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9


bind -n M-! join-pane -t :1
bind -n M-@ join-pane -t :2
bind -n 'M-#' join-pane -t :3
bind -n 'M-$' join-pane -t :4
bind -n M-% join-pane -t :5
bind -n M-^ join-pane -t :6
bind -n M-& join-pane -t :7
bind -n M-* join-pane -t :8
bind -n M-( join-pane -t :9

bind -n M-f resize-pane -Z


unbind C-b
set -g prefix 'C-b'

bind v split-window -h -c "#{pane_current_path}"
bind s split-window -v -c "#{pane_current_path}"
bind h select-pane -L 
bind j select-pane -D 
bind k select-pane -U 
bind l select-pane -R 

# 使用 Prefix + ( 和 Prefix + ) 的增强版，或自定义键位
bind -r J switch-client -n  # 切换到下一个会话
bind -r K switch-client -p  # 切换到上一个会话

set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# 开启自动恢复功能
set -g @continuum-restore 'on'

bind -r H resize-pane -L 5  # 向左扩大 5 单元格
bind -r J resize-pane -D 5  # 向下扩大 5 单元格
bind -r K resize-pane -U 5  # 向上扩大 5 单元格
bind -r L resize-pane -R 5  # 向右扩大 5 单元格

# ===================== 基础配置：启用 Vim 模式 =====================
# 1. 全局启用 Vi 风格的键盘布局（包括复制模式、命令行模式）
set -g mode-keys vi
# 2. 命令行模式（prefix + :）也启用 Vi 风格
set -g status-keys vi
# 3. 复制模式退出后自动同步到系统剪贴板（可选）
set -g set-clipboard on

# ===================== 复制模式（copy-mode-vi）核心绑定 =====================
# 基础移动（Vim 方向键）
bind -T copy-mode-vi h send-keys -X cursor-left        # 左
bind -T copy-mode-vi j send-keys -X cursor-down        # 下
bind -T copy-mode-vi k send-keys -X cursor-up          # 上
bind -T copy-mode-vi l send-keys -X cursor-right       # 右（修复原重复绑定问题）
bind -T copy-mode-vi 0 send-keys -X start-of-line      # 行首（Vim 0）
bind -T copy-mode-vi $ send-keys -X end-of-line        # 行尾（Vim $）
bind -T copy-mode-vi ^ send-keys -X start-of-line      # 行首（非空字符，Vim ^）

# 单词级移动（Vim 风格）
bind -T copy-mode-vi w send-keys -X next-word          # 下一个单词开头（Vim w）
bind -T copy-mode-vi b send-keys -X previous-word      # 上一个单词开头（Vim b）
bind -T copy-mode-vi e send-keys -X next-word-end      # 下一个单词结尾（Vim e）
bind -T copy-mode-vi W send-keys -X next-word-sep      # 下一个单词（按分隔符，Vim W）
bind -T copy-mode-vi B send-keys -X previous-word-sep  # 上一个单词（按分隔符，Vim B）

# 选区操作（Vim 可视化模式）
bind -T copy-mode-vi v send-keys -X begin-selection    # 开始字符选区（Vim v）
bind -T copy-mode-vi V send-keys -X select-line        # 整行选区（Vim V）
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle # 矩形选区（Vim Ctrl-v）
bind -T copy-mode-vi q send-keys -X cancel-selection   # 取消选区（Vim q/ESC）


is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?\.?(view|n?vim?x?)(-wrapped)?(diff)?$'"

bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' { if -F '#{pane_at_left}' '' 'select-pane -L' }
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' { if -F '#{pane_at_bottom}' '' 'select-pane -D' }
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' { if -F '#{pane_at_top}' '' 'select-pane -U' }
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' { if -F '#{pane_at_right}' '' 'select-pane -R' }
bind-key -n 'M-p' if 'test #{window_index} -gt #{base-index}' 'select-window -p'
bind-key -n 'M-n' if 'test #{window_index} -lt #{session_windows}' 'select-window -n'

bind-key -T copy-mode-vi 'C-h' if -F '#{pane_at_left}' '' 'select-pane -L'
bind-key -T copy-mode-vi 'C-j' if -F '#{pane_at_bottom}' '' 'select-pane -D'
bind-key -T copy-mode-vi 'C-k' if -F '#{pane_at_top}' '' 'select-pane -U'
bind-key -T copy-mode-vi 'C-l' if -F '#{pane_at_right}' '' 'select-pane -R'
bind-key -T copy-mode-vi 'M-p' if 'test #{window_index} -gt #{base-index}' 'select-window -p'
bind-key -T copy-mode-vi 'M-n' if 'test #{window_index} -lt #{session_windows}' 'select-window -n'


bind -n 'C-M-H' if-shell "$is_vim" 'send-keys C-M-h' 'swap-pane -s "{left-of}"'
bind -n 'C-M-J' if-shell "$is_vim" 'send-keys C-M-j' 'swap-pane -s "{down-of}"'
bind -n 'C-M-K' if-shell "$is_vim" 'send-keys C-M-k' 'swap-pane -s "{up-of}"'
bind -n 'C-M-L' if-shell "$is_vim" 'send-keys C-M-l' 'swap-pane -s "{right-of}"'

bind-key -T copy-mode-vi C-H swap-pane -s "{left-of}"
bind-key -T copy-mode-vi C-J swap-pane -s "{down-of}"
bind-key -T copy-mode-vi C-K swap-pane -s "{up-of}"
bind-key -T copy-mode-vi C-L swap-pane -s "{right-of}"

bind -n C-v copy-mode
bind -n 'M-h' if-shell "$is_vim" 'send-keys M-h' 'resize-pane -L 1'
bind -n 'M-j' if-shell "$is_vim" 'send-keys M-j' 'resize-pane -D 1'
bind -n 'M-k' if-shell "$is_vim" 'send-keys M-k' 'resize-pane -U 1'
bind -n 'M-l' if-shell "$is_vim" 'send-keys M-l' 'resize-pane -R 1'

bind-key -T copy-mode-vi M-h resize-pane -L 1
bind-key -T copy-mode-vi M-j resize-pane -D 1
bind-key -T copy-mode-vi M-k resize-pane -U 1
bind-key -T copy-mode-vi M-l resize-pane -R 1
set -g @plugin 'tmux-plugins/tpm'
run '~/.tmux/plugins/tpm/tpm'

bind-key -T copy-mode Escape send-keys -X cancel
bind-key -T copy-mode-vi Escape send-keys -X cancel

set -g status off

